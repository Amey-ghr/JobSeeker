<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Platform Registration</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: black;
        padding-top: 20px;
        padding-bottom: 40px;
      }
      .form-container {
        background-color: #fff;
        padding: 30px;
        margin-bottom: 30px;
      }
      .form-header {
        border-bottom: 1px solid #e9ecef;
        margin-bottom: 25px;
        padding-bottom: 15px;
      }
      .form-section {
        margin-bottom: 25px;
      }
      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 15px;
      }
      .btn-register {
        padding: 10px 30px;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="form-container">
            <div class="form-header text-center">
              <h2 class="text-primary">Account Registration</h2>
            </div>

            <form id="regForm">
              <div class="form-section">
                <div class="row g-3">
                  <div class="col-12">
                    <label for="userType" class="form-label"
                      >I am registering as:
                    </label>
                    <select class="form-select" id="userType" required>
                      <div class="invalid-feedback">required</div>
                      <option selected disabled value="">
                        Select user type
                      </option>
                      <option value="JobSeeker">Job Seeker</option>
                      <option value="Employer">Employer</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Personal Information -->
              <div class="form-section">
                <h3 class="section-title">Personal Information</h3>
                <div class="row g-3">
                  <div class="col-md-12">
                    <label for="Name" class="form-label">Full Name </label>
                    <input
                      type="text"
                      class="form-control"
                      id="Name"
                      required
                    />
                    <div class="invalid-feedback">required</div>
                  </div>
                  <div class="col-md-6">
                    <label for="email" class="form-label">Email Address </label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      required
                    />
                    <div class="invalid-feedback" id="emailError">
                      Email already exists
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="phone" class="form-label">Phone Number </label>
                    <input
                      type="tel"
                      class="form-control"
                      id="phone"
                      required
                    />
                    <div class="invalid-feedback">required</div>
                  </div>
                </div>
              </div>
              <!-- Company Information (for employers) -->
              <div class="form-section d-none" id="companySection">
                <h3 class="section-title mb-3">Company Information</h3>

                <div class="mb-3">
                  <label for="companyName" class="form-label"
                    >Company Name
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    id="companyName"
                    placeholder="Enter company name"
                  />
                  <div class="invalid-feedback">required</div>
                </div>

                <div class="mb-3">
                  <label for="location" class="form-label">Location</label>
                  <div class="invalid-feedback">required</div>
                  <select class="form-select" id="location" name="location">
                    <option value="">Select a location</option>
                    <option value="Pune">Pune</option>
                    <option value="Mumbai">Mumbai</option>
                    <option value="Bangalore">Bangalore</option>
                    <option value="Hyderabad">Hyderabad</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Chennai">Chennai</option>
                    <option value="Ahmedabad">Ahmedabad</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="industry" class="form-label">Industry</label>
                  <div class="invalid-feedback">required</div>
                  <select class="form-select" id="industry" name="industry">
                    <option value="">Select an industry</option>
                    <option value="Technology">Technology</option>
                    <option value="Finance">Finance</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Education">Education</option>
                    <option value="Manufacturing">Manufacturing</option>
                    <option value="Retail">Retail</option>
                  </select>
                </div>
              </div>

              <!-- Basic Information -->
              <div class="form-section">
                <h3 class="section-title">Profile Information</h3>
                <div class="row g-3">
                  <div id="linkedinField">
                    <label for="linkedinProfile" class="form-label"
                      >LinkedIn Profile URL
                    </label>
                    <input
                      type="url"
                      class="form-control"
                      id="linkedin"
                      required
                    />
                    <div class="invalid-feedback">required</div>
                  </div>
                </div>
              </div>

              <!-- Account Setup -->
              <div class="form-section">
                <h3 class="section-title">Account Setup</h3>
                <div class="row g-3">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="password" class="form-label">Password </label>
                      <input
                        type="password"
                        class="form-control"
                        id="password"
                        required
                      />
                      <div class="invalid-feedback">Passwords must match</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="confirmPassword" class="form-label"
                      >Confirm Password
                    </label>
                    <input
                      type="password"
                      class="form-control"
                      id="confirmPassword"
                      required
                    />
                    <div class="invalid-feedback">Passwords must match</div>
                  </div>
                </div>
              </div>

              <!-- Submit Button -->
              <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                <button type="button" class="btn btn-outline-secondary me-md-2">
                  Reset Form
                </button>
                <button type="submit" class="btn btn-primary btn-register">
                  Create Account
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      // User type selection
      const form = document.getElementById("regForm");
      const userTypeSelect = document.getElementById("userType");
      const companySection = document.getElementById("companySection");
      const companyName = document.getElementById("companyName");

      const NameInput = document.getElementById("Name");
      const emailInput = document.getElementById("email");
      const phoneInput = document.getElementById("phone");
      const linkedinProfile = document.getElementById("linkedin");
      const passwordInput = document.getElementById("password");
      const confirmInput = document.getElementById("confirmPassword");

      //employer
      const companyNameInput = document.getElementById("companyName");
      const locationInput = document.getElementById("location");
      const industryInput = document.getElementById("industry");

      userTypeSelect.addEventListener("change", function () {
        const type = this.value;

        // Show/hide company section based on user type
        if (type === "Employer") {
          companySection.classList.remove("d-none");
          companyName.setAttribute("required", "");
        } else {
          companySection.classList.add("d-none");
          companyName.removeAttribute("required");
        }
      });

      //submit

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        // Check passwords match
        if (passwordInput.value !== confirmInput.value) {
          confirmInput.classList.add("is-invalid");
          passwordInput.classList.add("is-invalid");
          return;
        } else {
          confirmInput.classList.remove("is-invalid");
          passwordInput.classList.remove("is-invalid");
        }
        if (!validateForm()) return;

        regUser();
      });

      //validating
      function validateForm() {
        let isValid = true;
        [NameInput].forEach((input) => {
          if (input.value.trim().length < 5) {
            input.classList.add("is-invalid");
            input.classList.remove("is-valid");
            isValid = false;
          } else {
            input.classList.remove("is-invalid");
            input.classList.add("is-valid");
          }
        });
        return isValid;
      }

      //register user after validating

      function regUser() {
        const userType = userTypeSelect.value;

        const userObject = {
          userType: userType.toLowerCase(),
          name: NameInput.value.trim(),
          email: emailInput.value.trim(),
          phone: phoneInput.value.trim(),
          resume: linkedinProfile.value.trim(),
          password: passwordInput.value,
        };

        if (userObject.userType === "employer") {
          userObject.company = {
            name: companyNameInput.value.trim(),
            location: locationInput.value,
            industry: industryInput.value,
          };
        }

        fetch("http://localhost:8080/api/auth/register", {
          method: "POST",
          //authentication: getBasicAuth(),
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(userObject),
        })
          .then((response) => {
            if (!response.ok) {
              return response.text().then((error) => {
                if (response.status === 409) {
                  emailInput.classList.add("is-invalid");
                  document.getElementById("emailError").textContent = error;
                }
                throw new Error(error);
              });
            }
            return response.text();
          })
          .then(() => {
            emailInput.classList.remove("is-invalid");
            emailInput.classList.add("is-valid");
            document.getElementById("emailError").textContent = "";

            form.reset();
            window.location.href = "login.html";
          })
          .catch((err) => console.error("Registration failed:", err));
      }
    </script>
  </body>
</html>
